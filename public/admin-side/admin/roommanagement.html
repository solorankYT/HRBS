<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H+Hotel - Room Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
     <link href="../css/styles.css" rel="stylesheet">
    <script>
        (function() {
            try {
                if (localStorage.getItem('sidebarCollapsed') === 'true') {
                    document.documentElement.classList.add('precollapsed');
                }
            } catch (e) {}
        })();
    </script>
    <style>
        /* Font Family Declarations */
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        /* Headers and Titles */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        .reservation-title {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }
        
        .hotel-name {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        .admin-label {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }
        
        /* Navigation */
        .nav-link {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        .nav-link span {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        /* Profile Section */
        .profile-name {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        
        .profile-role {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        /* KPI Cards */
        .kpi-number {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }
        
        .kpi-label {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        /* Room Card Headers */
        .info-card .card-header h5 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        /* Room Details */
        .field-label {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        .detail-value {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        .room-capacity {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        .amenity-item {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        .room-description {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        /* Status Badges */
        .status-badge {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        
        /* Search and Input Elements */
        .search-input {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        /* Buttons */
        .btn {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        .new-reservation-btn {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        
        .room-edit-large {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        /* Modal Elements */
        .modal-title {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        .form-label {
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        
        .form-control, .form-select {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        /* Remove card hover effects and transitions on this page */
        .info-card { transition: none !important; }
        .info-card:hover { transform: none !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important; }
        .kpi-card { transition: none !important; }
        .kpi-card:hover { transform: none !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important; }
        /* Large Edit button styling */
        .room-edit-large {
            background-color: #e7f1ff;
            color: #0d6efd;
            border: 1px solid #cfe2ff;
            border-radius: 6px;
            padding: 0.45rem 1rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
            justify-content: center;
        }
        .room-edit-large:hover { background-color: #d7e7ff; color: #0b5ed7; }
        .room-actions { display: flex; align-items: center; gap: 8px; }
        .room-delete { color: #6c757d; }
        .room-delete:hover { color: #dc3545; }
    </style>
    <style>
        /* Make + Add Room Type button completely static (no hover/focus/active change) */
        #addRoomTypeBtn,
        #addRoomTypeBtn:hover,
        #addRoomTypeBtn:focus,
        #addRoomTypeBtn:active,
        #addRoomTypeBtn:focus-visible {
            box-shadow: none !important;
            outline: none !important;
            text-decoration: none !important;
            transform: none !important;
            transition: none !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="sidebar-header clickable" id="sidebarToggle">
                    <span class="logo-text">logo</span>
                    <h4 class="hotel-name">H+Hotel</h4>
                    <i class="fas fa-bars toggle-icon" aria-label="Collapse sidebar"></i>
                </div>
                
                <ul class="nav flex-column main-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" data-tooltip="Dashboard">
                            <i class="fas fa-th-large"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reservations.html" data-tooltip="Reservations">
                            <i class="fas fa-calendar"></i>
                            <span>Reservations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="payment.html" data-tooltip="Payments">
                            <i class="fas fa-credit-card"></i>
                            <span>Payments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                      
                        <a class="nav-link" href="usermanagement.html" data-tooltip="User Management">
                            <i class="fas fa-users"></i>
                            <span>User Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="roommanagement.html" data-tooltip="Room Management">
                            <i class="fas fa-bed"></i>
                            <span>Room Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reports.html" data-tooltip="Reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                </ul>
                
                <ul class="nav flex-column secondary-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html" data-tooltip="Settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                   <li class="nav-item">
                        <button class="nav-link"data-tooltip="Logout" onclick="logout()" type="button">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </button>
                    </li>
                </ul>
                
                <div class="profile-section">
                    <div class="profile-info" data-tooltip="Prince Gallardo - Admin">
                        <i class="fas fa-user-circle profile-icon"></i>
                        <div>
                            <div class="profile-name">Prince Gallardo</div>
                            <div class="profile-role">Admin</div>
                        </div>
                    </div>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="top-bar-header d-flex justify-content-between align-items-center">
                    <div class="left-section">
                        <span class="admin-label">Admin</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="search-container me-4" style="margin-left: -1rem;">
                            <input type="text" class="form-control search-input" placeholder="Search reservations...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="notification-icon me-3">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="user-dropdown">
                            <i class="fas fa-user-circle me-2"></i>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>

                <div class="reservation-header d-flex justify-content-between align-items-center mb-4">
                    <h1 class="reservation-title">Room Management</h1>
                    <button class="btn btn-primary new-reservation-btn" id="addRoomBtn">
                        <i class="fas fa-plus me-2"></i>Add Room
                    </button>
                </div>

                <!-- Summary Cards -->
             <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon light-blue">
                            <i class="fas fa-bed"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-number" id="kpiTotalRooms">0</h3>
                            <p class="kpi-label">Total Rooms</p>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-number" id="kpiAvailable">0</h3>
                            <p class="kpi-label">Available</p>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon purple">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-number" id="kpiMaintenance">0</h3>
                            <p class="kpi-label">Maintenance</p>
                        </div>
                    </div>
                </div>
            </div>

                    <div class="d-flex gap-2 mb-3">
                        <select class="form-select w-auto" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="available">Available</option>
                            <option value="maintenance">Maintenance</option>
                        </select>

                        <select class="form-select w-auto" id="filterType">
                            <option value="">All Types</option>
                            <option value="Basic Studio Room">Basic Studio Room</option>
                            <option value="Standard Room">Standard Room</option>
                            <option value="Family Room">Family Room</option>
                            <option value="Premium Room">Premium Room</option>
                        </select>
                    </div>

                  <div class="table-responsive table-scroll">
                       <table class="table table-hover reservations-table">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Room</th>
                                    <th>Type</th>
                                    <th>Rate</th>
                                    <th>Capacity</th>
                                    <th>Status</th>
                                    <th>Amenities</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="roomsTableBody"></tbody>
                        </table>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/script.js"></script>
    <script src="../js/auth.js"></script>

 <!-- Load ROMMS -->
      <script>
        async function loadRooms() {
                    const res = await fetch('http://localhost:8000/api/rooms', {
                        credentials: 'include',
                        headers: { 'Accept': 'application/json', "Content-Type": "application/json" }
                    });

                    const rooms = await res.json();
                    const tbody = document.getElementById('roomsTableBody');
                    tbody.innerHTML = '';

                    let available = 0, occupied = 0, maintenance = 0;

                    rooms.forEach((room, index) => {
                        if (room.status === 'Available') available++;
                        if (room.status === 'Maintenance') maintenance++;

                        tbody.innerHTML += renderRoomRow(room, index + 1);
                    });

                       updateRoomKPIs(rooms);
                }
      </script>

<!-- FILTER ROWS -->
                <script>
                    function applyFilters() {
                        const status = document.getElementById('filterStatus').value;
                        const type = document.getElementById('filterType').value;

                        document.querySelectorAll('#roomsTableBody tr').forEach(row => {
                            const matchStatus = !status || row.dataset.status === status;
                            const matchType = !type || row.dataset.type === type;

                            row.style.display = (matchStatus && matchType) ? '' : 'none';
                        });
                    }

                    document.getElementById('filterStatus').addEventListener('change', applyFilters);
                    document.getElementById('filterType').addEventListener('change', applyFilters);
                </script>

 <!-- TABLE ROMMS -->
      <script>
       function renderRoomRow(room, index) {
                const badgeClass =
                    room.status === 'available' ? 'bg-success' :
                    room.status === 'maintenance' ? 'bg-danger' :
                    'bg-warning text-dark';

                return `
                    <tr data-status="${room.status}" data-type="${room.type}">
                        <td>${index}</td>
                        <td>${room.room_number}</td>
                        <td>${room.type}</td>
                        <td>₱${Number(room.price).toLocaleString()}</td>
                        <td>${room.capacity}</td>
                        <td>
                            <span class="badge ${badgeClass}">
                                ${room.status}
                            </span>
                        </td>
                        <td class="text-muted small">
                            ${room.amenities}
                        </td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-primary"
                                    onclick="editRoom(${room.id})">
                                Edit
                            </button>
                        </td>
                    </tr>
                `;
            }

      </script>

<!-- KPI ROOOMMMS -->
<script> 
function updateRoomKPIs(rooms) {
    let available = 0;
    let occupied = 0;
    let maintenance = 0;

    rooms.forEach(room => {
        if (room.status === 'available') available++;
        else if (room.status === 'maintenance') maintenance++;
    });

    document.getElementById('kpiTotalRooms').textContent = rooms.length;
    document.getElementById('kpiAvailable').textContent = available;
    document.getElementById('kpiMaintenance').textContent = maintenance;
}

</script>


<script>
document.addEventListener('DOMContentLoaded', loadRooms);
</script>

    
    <!-- Add Room Type Modal -->
    <div class="modal fade" id="addRoomTypeModal" tabindex="-1" aria-labelledby="addRoomTypeLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRoomTypeLabel">Add Room Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addRoomTypeForm">
                        <div class="row g-3">

                            <div class="col-md-6">
                                <label class="form-label">Room number</label>
                                <input type="text" class="form-control" name="room_number">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Room Type</label>
                                <select class="form-select" name="type" id="type">
                                    <option value="" selected disabled>Select room type</option>
                                    <option value="Basic Studio Room">Basic Studio Room</option>
                                    <option value="Standard Room">Standard Room</option>
                                    <option value="Family Room">Family Room</option>
                                    <option value="Premium Room">Premium Room</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Base Rate per night (₱)</label>
                                <input type="number" class="form-control" name="price" id="price" min="0" step="1" placeholder="3500">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Default Capacity</label>
                                <input type="number" class="form-control" name="capacity" id="capacity" min="1" step="1" placeholder="2">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" name="status">
                                    <option value="available" selected>Available</option>
                                    <option value="maintenance ">Maintenance</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Amenities</label>
                                <div class="d-flex flex-wrap gap-3">
                                    <div class="form-check"><input class="form-check-input" type="checkbox" name="amenities[]" value="wifi"><label class="form-check-label" for="addAmenWifi">Wifi</label></div>
                                    <div class="form-check"><input class="form-check-input" type="checkbox" name="amenities[]" value="tv"><label class="form-check-label" for="addAmenTv">Tv</label></div>
                                    <div class="form-check"><input class="form-check-input" type="checkbox" name="amenities[]" value="ac"><label class="form-check-label" for="addAmenAc">Ac</label></div>
                                </div>
                            </div>
                        </div>
                 
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
            </div>
        </div>
    </div>

    <!-- Edit Room Modal -->
    <div class="modal fade" id="editRoomModal" tabindex="-1" aria-labelledby="editRoomLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRoomLabel">Edit Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Room Number</label>
                                <input type="text" class="form-control" id="editRoomNumber" disabled>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <input type="text" class="form-control" id="editRoomType">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Rate per night</label>
                                <input type="text" class="form-control" id="editRoomRate">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="editRoomCapacity" min="1">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="editRoomStatus">
                                    <option value="available">Available</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Amenities</label>
                                <div class="d-flex flex-wrap gap-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="amenities[]" id="amenityWifi" value="wifi">
                                        <label class="form-check-label" for="amenityWifi">Wifi</label>
                                        </div>
                                        <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="amenities[]" id="amenityTv" value="tv">
                                        <label class="form-check-label" for="amenityTv">Tv</label>
                                        </div>
                                        <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="amenities[]" id="amenityAc" value="ac">
                                        <label class="form-check-label" for="amenityAc">Ac</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                  
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
                  </form>
            </div>
        </div>
    </div>


    <!-- CREATE ROOMMMMMMMMMM -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const addRoomButton = document.getElementById("addRoomBtn");
    const addRoomTypeModalEl = document.getElementById("addRoomTypeModal");

    const addRoomTypeModal = new bootstrap.Modal(addRoomTypeModalEl);

    addRoomButton.addEventListener("click", () => {
        addRoomTypeModal.show();
    });

    document.getElementById("addRoomTypeForm")
        .addEventListener("submit", async function (e) {
            e.preventDefault();

            const roomNumber = this.room_number.value.trim();
            const type = this.type.value;
            const price = Number(this.price.value);
            const capacity = Number(this.capacity.value);

            if (!roomNumber) {
                alert("Room number is required");
                return;
            }

            if (!type) {
                alert("Please select a room type");
                return;
            }

            if (price <= 0) {
                alert("Price must be greater than 0");
                return;
            }

            if (capacity < 1) {
                alert("Capacity must be at least 1");
                return;
            }



            const formData = new FormData(this);

            try {
                const res = await fetch("http://localhost:8000/api/rooms", {
                    method: "POST",
                    credentials: "include",
                    headers: { "Accept": "application/json" },
                    body: formData
                });

                const data = await res.json();

                if (!res.ok) {
                    if (res.status === 422 && data.errors) {
                        const firstError = Object.values(data.errors)[0][0];
                        alert(firstError);
                        return;
                    }
                    throw new Error(data.message || "Failed");
                }


                alert("Rooms Added");
                addRoomTypeModal.hide();
                loadRooms();

            } catch (err) {
                console.error(err);
                alert("Error adding user");
            }

        });
        
    });
    </script>

    <!-- Update ROOOOOOOOOOOOM -->
     <script>
        let editingRoomId = null;
        function editRoom(id) {
            editingRoomId = id;

            fetch(`http://localhost:8000/api/rooms/${id}`, {
                credentials: "include",
                headers: { "Accept": "application/json" }
            })
            .then(res => res.json())
            .then(rooms => {
                document.getElementById("editRoomNumber").value = rooms.room_number;
                document.getElementById("editRoomType").value = rooms.type;
                document.getElementById("editRoomRate").value = rooms.price;
                document.getElementById("editRoomCapacity").value = rooms.capacity;
                document.getElementById("editRoomStatus").value = rooms.status;
          
                  const amenities = rooms.amenities;
                    ['wifi', 'tv', 'ac'].forEach(a => {
                        const checkbox = document.getElementById('amenity' + a.charAt(0).toUpperCase() + a.slice(1));
                        if (checkbox) checkbox.checked = amenities.includes(a);
                    });
                     });

            new bootstrap.Modal(document.getElementById("editRoomModal")).show();
        }
    </script>

    <!-- SAVE UPDATE CHANGE -->
    <script>
        document.getElementById("editRoomForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            if (!editingRoomId) return alert("No room selected");

            const amenities = Array.from(
                document.querySelectorAll('input[name="amenities[]"]:checked')
            ).map(cb => cb.value);

            const payload = {
                type: document.getElementById("editRoomType").value,
                price: document.getElementById("editRoomRate").value,
                capacity: document.getElementById("editRoomCapacity").value,
                status: document.getElementById("editRoomStatus").value,
                amenities: amenities,
            };

            try {
                const res = await fetch(`http://localhost:8000/api/rooms/${editingRoomId}`, {
                    method: "PUT",
                    credentials: "include",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.message);

                alert("Room updated successfully");
                bootstrap.Modal.getInstance(
                    document.getElementById("editRoomModal")
                ).hide();

                loadRooms();
            } catch (err) {
                console.error(err);
                alert("Error editing room");
            }
        });
        </script>


    <!-- RATE PRICEE edit only if rate is changed or capacity by TYPE-->
        <script>
        (function () {
            const rateByType = {
                'Basic Studio Room': 1500,
                'Standard Room': 2500,
                'Family Room': 3500,
                'Premium Room': 5000
            };

            const capacityByType = {
                'Basic Studio Room': 2,
                'Standard Room': 4,
                'Family Room': 5,
                'Premium Room': 6
            };

            const typeSel = document.getElementById('type');
            const rateInput = document.getElementById('price');
            const capacityInput = document.getElementById('capacity');

            if (typeSel) {
                typeSel.addEventListener('change', function () {
                    const val = this.value;

                    if (rateInput) {
                        rateInput.value = rateByType[val] ?? '';
                    }

                    if (capacityInput) {
                        capacityInput.value = capacityByType[val] ?? '';
                    }
                });
            }
        })();
        </script>


    
</body>
</html>
